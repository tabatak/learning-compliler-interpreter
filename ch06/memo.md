# コードの生成
## 6.1 コード生成関数
## 6.2 変数の大域・局所判定
## 6.3 左辺値と右辺値
## 6.4 一次式の処理
### 一次式とは
式処理の基本要素となるもの
- 識別子
- 定数
- 文字列
- かっこで囲まれた式

### 整数定数の処理
トークンに格納された整数値をLDI命令で処理

### 文字列リテラルの処理
リテラル格納番地をLDI命令で処理

### 単純変数の処理
トークンが識別子の場合、登録名の種類（fncId, protId, varId, paraId）で処理を切り分け。

### 配列変数の処理
配列の場合は添え字を計算して、それを変数アドレスに加算し、求めたアドレスの内容を取り出す命令を作る。

```C
int dt[6]m n;       //dtは48番地、nは72番地に割り付け
```
があるとき、dt[3]に相当する番地は次のように求める。（dt配列は48番地から確保されているものとする）
1. 配列先頭アドレスの48を求める
2. 添字の値3を求める
3. 添字値3にint型1個分のバイト幅(=4)をかける。これが配列先頭からの距離。
4. 先頭アドレス(1)に距離(3)を加える（ 48 + 3 * 4 = 60）

dt[3]の右辺値の生成コード
```
LDA 48  ;dtのアドレス
LDI 12  ;3*4(定数畳み込み)
ADD     ;dt[3]のアドレス
VAL     ;アドレスの内容
```

dt[n]の右辺値生成コード
```
LDA 48  ;dtのアドレス
LOD 72  ;n
LDI 4   ;int型の幅
MUL     ;n*4
ADD     ;dt[n]のアドレス
VAL     ;アドレスの内容
```

### 関数呼び出しの処理
### カッコの処理

## 6.5 炭鉱演算子の処理
### + - ! 演算子
後続の要素を処理し、それに対して単項演算命令を生成する。
```C
a = -b;
```

生成コード
```
LDA 4   ;a
LOD 8   ;b
NEG     ;-単項演算子
ASS     ;=
```

### 前置++ 前置-- 演算子
オペランドを左辺値に変更する必要がある。
同時に「左辺値に変更可能か」の確認を行う。
```C
a = ++b;
```

生成コード
```
LDA 4   ;a
LDA 8   ;b(LODではなくLDA)
INC     ;++
ASS     ;=
```

### 左辺値への変更
変数aの割り付けアドレスが8番地のとき、「a = a;」という文は次のコードになる。
```C
a = a;
```

生成コード
```
LDA 8   ;変数aの番地（左辺値）
LOD 8   ;変数aの値（右辺値）
ASS     ;代入
```

### 後置++ 後置-- 演算子
単純変数や配列変数はうしろに++または--をしたがえていることがある。
後置型の場合、通常の変数処理を終えてから、++、--演算子を発見する。
「a = b++;」の場合の処理は以下の通り
1. 変数bの内容を+1する。結果をスタックに入れる。（b=6, スタック=6）
2. スタック値を-1する。（スタック=5）
3. スタック値を変数aに格納する。（a=5）

## 6.6 二項演算子の処理
### 標準的な二項演算子の処理
二項演算子は「値１ 演算子 値2」の形式。
多くの場合、「スタックから二つの値を取り出し、演算をして、結果値をスタックに戻す」という動作。

```C
a + b;
```

生成コード
```
LOD 4   ;aの値をスタックに積む
LOD 8   ;bの値をスタックに積む
ADD     ;二項演算子+
```

### 代入演算子の処理
もっとも優先順位が低い。
以下の特徴がある。
- 左辺値を用いる
- 右結合である
- 式の値が不要の場合がある

「a = b;」の動作は以下の通り。
1. aの右辺値を取り出す
2. 次のトークンが"="であることを認識する
3. (1)で得た右辺値を「左辺値に変更」する
4. bの右辺値を取り出す
5. 代入命令ASSVを出力する

生成コード
```
LDA 4   ;a
LOD 8   ;b
ASSV    ;=
```
ASSV命令は「代入し、式の値をスタックに積む」という処理。（Assign and Value）

```C
a = b = c;
```
生成コード
```
LDA 4   ;a
LDA 8   ;b
LOD 12  ;c
ASSV    ;[b=c]を実行し式の値を残す
ASS     ;[a=b]を実行し式の値を残さない
```

### 型チェックと型変換

## 6.7 定数畳み込み
数値定数が連続して使われていたり、数値定数に対する単項演算子処理が行われているときは、コンパイル時点で数値定数に対する演算を先に済ませ、単一の数値定数にすればコードが短くなり、処理も早くなる。->「定数畳み込み」または「定数計算」

「a = 10 + 20;」が「a = 30;」になる。
