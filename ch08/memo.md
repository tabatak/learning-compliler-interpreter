# 文の処理

## 8.1 文とブロックの処理
「文」は実行すべき動作を指定するもの。
Cでは関数定義記述の中の複合文（ブロック）から文処理が開始される。

関数定義：型名 関数名 引数並び 複合文
複合文：{ 0個以上の宣言 0個以上の文 }
文：  名札付き文
      複合文
      式文
      選択文
      繰り返し文
      分岐文

文処理はstatement()関数が受け持ち、複合文処理はblock()関数が受け持つ。

## 8.2 式文
式記述に ; を付与すると「式文」と呼ばれる文になる。
式の処理は基本的には、式解析を行うexpression()関数を呼び出すだけ。

## 8.3 複合文
### 複合文の処理
文処理の中で'{'というトークンを発見したら、block()関数を呼び出す。
block()関数内の処理は以下の通り。
1. 関数ブロックの場合、局所変数宣言処理をする
2. ブロックのネスト管理をする
3. トークン'}'に出会うまでstatement()関数を呼び出す

### ブロック内変数宣言
本来のC言語では、関数ブロックだけでなく任意のブロック内で局所変数を宣言できる。
今回は局所変数宣言は関数ブロックの先頭だけに制限する。

### ブロックネストの管理
処理の過程でblock()は再帰コールされるので、そのネスト状態を管理する。
ブロック処理に入るたびにblkNestを+1し、終了するたびに-1しておくと、以下のような判断が可能になる。
1. blkNestが0のときは現在大域領域のコード処理中
2. blkNestが1のときの変数宣言は局所変数
3. blkNestが2以上のときは関数ブロック内のさらに{}内の処理中

### 実行文の処理

## 8.4 while文
```
while(式) 文
```

「式」の処理はexpression()関数に、「文」の処理はstatement()関数にまかせる。
制御文として行うのは、文字通り制御の方向を決めること。
必要な処理パターンは以下の通り。
1. 無条件に〇行へジャンプ（JMP命令）
2. 条件式結果が偽なら〇行へジャンプ（JPF命令）
3. 条件式結果が真なら〇行へジャンプ（JPT命令）

通常の制御文処理では(3)はあまり使わない。理由は真の場合は次行に進むだけのことが多いため。
(3)を使うのはdo-while文。

## 8.5 do文
```
do 文 while (式);
```
do文とwhile文の違いは、条件式判定が末尾にくること、条件式の結果が真なら先頭にジャンプすること。

## 8.6 for文
```
for (式１, 式２, 式３) 文
```
for文の本体内にcontinue文も、break文もない場合、C文法ではwhile文で代替可能。
for文を解析する場合、while形式を意識して、式３の位置を移動させれば効率の良いコード生成が可能。

## 8.7 if文
```
if (式) 文
if (式) 文１ else 文２
```

## 8.8 continue文とbreak文
### JMP命令のリストを作る
```
continue;
break;
```

continue文はループ制御の内部に記述し、そのループ処理の先頭に処理を移す。
break文はループ制御文およびswitch文の内部に記述し、そのブロックの処理を打ち切る。

1. 制御文の開始時の処理
  -> <top番地>を記憶する
2. 制御文内での処理
  -> continue文があったら「JMP <top番地>」の命令を生成
  -> break文があったら「JMP -1」の命令を生成
  -> それ以外の文は通常の命令を生成
3. 制御文終了時の処理
  -> 確定した<end番地>を使って、「JMP -1」の飛び先番地をバックパッチ

### break処理の簡易実装

### ネスト処理の対策
多重ループ内でのcontinueやbreak処理に対応するため、ネストの履歴を保持する必要がある。

### continue/breakの前処理と後処理

### continueの処理
### breakの処理

## 8.9 switch文
### switch文の機能
```
switch (式) 文
```

## 8.10 return文
```
return;
return 式;
```

return文があると、関数の終了処理が必要。
RET命令をひとつ置けばいいのではなく、戻り番地の処理なども入れた複数命令になる。

return文は関数内に複数回登場する可能性があるが、RET命令列は関数末尾に一つだけ置く。
関数途中のreturn文は、そこへのJMP命令を生成する。

main()関数だけは、関数末尾にreturn文がない場合、自動的に[return 0;]を入れる。
